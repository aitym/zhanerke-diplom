<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zhanerke Diplom</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <nav>
            <h1>Zhanerke Diplom</h1>
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="#">C8</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">C9</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">C10</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">C11</a>
                </li>
            </ul>
        </nav>
    </header>
    <main>
        <form enctype="multipart/form-data">
            <input id="upload" type=file name="files[]">
        </form>
        <textarea class="form-control" rows=35 cols=120 id="xlx_json"></textarea>
    </main>
    <footer></footer>
    <script src="https://unpkg.com/alpinejs"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
    <script>
        var collected_data = {};

        function download(content, fileName, contentType) {
            var a = document.createElement("a");
            var file = new Blob([content], {type: contentType});
            a.href = URL.createObjectURL(file);
            a.download = fileName;
            a.click();
        }

        var ExcelToJSON = function() {
            this.parseExcel = function(file) {
                var reader = new FileReader();

                reader.onload = function(e) {
                    var data = e.target.result;
                    var workbook = XLSX.read(data, {
                        type: 'binary'
                    });
                    workbook.SheetNames.forEach(function(sheetName) {
                        var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                        XL_row_object = XL_row_object.map(function (row) {
                            return {x: (+row.x).toFixed(20), y: (+row.y).toFixed(20)};
                        });
                        collected_data[sheetName] = XL_row_object;
                        var json_object = JSON.stringify(XL_row_object);
                        jQuery('#xlx_json').val(json_object);
                    });
                    download(jQuery('#xlx_json').val(), 'json.txt', 'text/plain');
                };

                reader.onerror = function(ex) {
                    console.log(ex);
                };

                reader.readAsBinaryString(file);
            };
        };

        function handleFileSelect(evt) {
            var files = evt.target.files;
            var xl2json = new ExcelToJSON();
            xl2json.parseExcel(files[0]);
        }
    </script>
    <script>
        document.getElementById('upload').addEventListener('change', handleFileSelect, false);
    </script>
    <script src="app.js"></script>
</body>
</html>